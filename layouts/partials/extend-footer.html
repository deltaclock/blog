<script>
    // set data-href to all a elements
    for (const a of document.getElementsByTagName("a")) {
        a.dataset.href = a.attributes.href.nodeValue;
    }

    const open_regex = new RegExp(`"(.+)"`);

    for (const span of document.querySelectorAll("span[onclick]")) {
        let open_url = open_regex.exec(span.attributes.onclick.nodeValue)[1];

        span.setAttribute("title", open_url);
        span.addEventListener("mouseover", (e) => {
            const article_node = e.target.closest("a");
            article_node.href = open_url;
        });
        span.addEventListener("mouseout", (e) => {
            const article_node = e.target.closest("a");
            article_node.href = article_node.dataset.href;
        });
    }

    // resize featured div box when the text changes
    const article_text = document.querySelector("section > div:nth-child(2)");
    const featured_div = document.querySelector(".single_hero_basic");

    if (article_text) {
        new ResizeObserver((entries) => {
            for (const entry of entries) {
                // get element before paint
                const new_elem = entry?.contentBoxSize?.[0];
                if (new_elem) {
                    featured_div.style.width = `${new_elem.inlineSize}px`;
                }
            }
        }).observe(article_text);
    }

    // my own scroll blurring
    const BLUR_DIV = document.querySelector("#background-blur");
    const MENU = document.getElementById("menu-blur");
    const DEFAULT_OPACITY = parseFloat(getComputedStyle(BLUR_DIV).opacity);

    window.addEventListener("scroll", function (event) {
        const scroll = window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0;
        const new_opacity = Math.min(1, Math.max(DEFAULT_OPACITY, DEFAULT_OPACITY + (scroll / 1000)));
        BLUR_DIV.style.opacity = new_opacity;
        MENU.style.opacity = new_opacity;
        event.stopImmediatePropagation();
    }, { capture: true });


</script>